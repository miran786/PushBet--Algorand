---
phase: 6
plan: 2
wave: 2
---

# Plan 6.2: Frontend ‚Äî AI-Governed Marketplace UI

## Objective
Rewrite `Marketplace.tsx` to replace the traditional buy/sell NFT marketplace with a chat-driven, need-based AI-governed marketplace. Students describe needs, others fulfill them, AI verifies proof, and payment is released.

## Context
- `.gsd/phases/6/RESEARCH.md`
- `.gsd/phases/6/6.1-PLAN.md` ‚Äî Backend API (must be complete first)
- `src/app/pages/Marketplace.tsx` ‚Äî Current marketplace (will be fully rewritten)
- `src/app/pages/Dashboard.tsx` ‚Äî Dashboard card description should be updated
- `src/app/routes.ts` ‚Äî Route already exists at `/marketplace`

## Tasks

<task type="auto">
  <name>Rewrite Marketplace.tsx ‚Äî Need-Based AI Marketplace</name>
  <files>src/app/pages/Marketplace.tsx</files>
  <action>
    Completely rewrite `Marketplace.tsx` with the following sections:

    **1. Header Section:**
    - Title: "AI MARKETPLACE" with robot icon
    - Tagline: "Describe any need. AI builds the contract. Algorand releases the payment."
    - Two tabs: "üîç Browse Needs" | "‚ú® Post a Need"

    **2. Post a Need Tab (Chat-Style):**
    - Full-screen chat interface where user types their need
    - On submit, POST to `/api/marketplace/needs`
    - AI response shows:
      - Category badge (e.g. "üìö Notes", "üîë Lost Item", "üèÉ Errand")
      - Auto-generated "Smart Contract Terms" (from Gemini) in a styled card
      - Reward input with ALGO amount
      - "LOCK REWARD & POST" button (creates Algorand payment txn to escrow)
    - Animated typing indicator while AI thinks

    **3. Browse Needs Tab:**
    - Grid of open needs as cards, each showing:
      - Category icon + badge
      - Description (the original need text)
      - Reward amount in ALGO
      - AI-generated terms (collapsible)
      - Requester wallet (truncated)
      - Time remaining (from expiresAt)
      - "ACCEPT & FULFILL" button
    - Empty state: "No open needs. Be the first to post one!"

    **4. Fulfillment Flow (after clicking Accept):**
    - Modal/overlay with:
      - Original need description
      - AI terms (what proof is required)
      - Text area for proof description
      - Image upload for proof (use FileReader to convert to base64)
      - "SUBMIT PROOF FOR AI VERIFICATION" button
    - On submit, POST to `/api/marketplace/needs/:id/submit-proof`
    - Show AI verification result:
      - ‚úÖ VERIFIED: confidence score, reason, "Payment Released!" animation
      - ‚ùå REJECTED: reason, "Try Again" button

    **5. Styling:**
    - Dark theme matching existing app (bg-gray-900, neon accents)
    - Use existing CSS variables: --electric-volt, --neon-purple
    - Glassmorphism cards with backdrop-blur
    - Animated gradient borders on the "Post a Need" chat area
    - Pulse animation on reward amounts
    - Use react-icons: FaRobot, FaBrain, FaLock, FaCheckCircle, FaTimes, FaPaperPlane, FaCamera, FaCoins

    **State Management:**
    - `activeTab`: 'browse' | 'post'
    - `needs`: array of open needs from API
    - `selectedNeed`: the need being fulfilled
    - `proofDescription`, `proofImage`: fulfillment proof
    - `isSubmitting`, `isVerifying`: loading states
    - `verificationResult`: AI response

    **API Integration:**
    - Use `fetch` to call `http://localhost:8000/api/marketplace/needs` endpoints
    - Use `useWallet()` from `@txnlab/use-wallet-react` for wallet address
    - Use `algosdk` for the escrow payment transaction (simple `makePaymentTxn` to a known address)
    - Use `toast` from `sonner` for notifications

    **Do NOT change:**
    - Routes (already at /marketplace)
    - Any other component files
  </action>
  <verify>
    Open http://localhost:5173/marketplace in browser.
    Verify: two tabs visible, chat interface on "Post a Need", grid on "Browse Needs".
  </verify>
  <done>Marketplace page loads without errors, both tabs render correctly, API calls work end-to-end.</done>
</task>

<task type="auto">
  <name>Update Dashboard Card Description</name>
  <files>src/app/pages/Dashboard.tsx</files>
  <action>
    Find the Marketplace card in Dashboard.tsx and update:
    - Description from "Buy and sell campus goods. Textbooks, electronics, and more." 
    - To: "Describe any need. AI builds the contract. Algorand pays on proof."
    - Keep the same icon and route
  </action>
  <verify>Check Dashboard.tsx contains updated marketplace description text.</verify>
  <done>Dashboard shows new marketplace description.</done>
</task>

## Success Criteria
- [ ] Marketplace.tsx fully rewritten with need-based AI interface
- [ ] Post a Need tab: chat-style UI with AI-generated terms
- [ ] Browse Needs tab: grid of open needs with Accept button
- [ ] Fulfillment flow: proof submission with AI verification
- [ ] Dashboard card description updated
- [ ] No console errors on page load
